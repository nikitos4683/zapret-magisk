<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Настройка zapret</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/beercss@3.11.20/dist/cdn/beer.min.css">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.11.20/dist/cdn/beer.min.js"></script>
    <script src="/i18n.js"></script>
    <style>
        @font-face {
            font-family: "Google Sans";
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/googlesans/v27/4UaGrENHsxJlGDuGo1OIlL3Kwp5MKg.woff2) format("woff2");
            unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116
        }

        @font-face {
            font-family: "Google Sans";
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/googlesans/v27/4UaGrENHsxJlGDuGo1OIlL3Owp4.woff2) format("woff2");
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD
        }

        body {
            user-select: none;
            font-family: "Google Sans";
        }
        
        /* Clean minimalist styling matching other pages */
        .status-container {
            text-align: center;
            padding: 40px 0;
        }
        .status-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
    </style>
    <script type="module">
        import { exec, toast } from '/kernelsu.js';

        // Check Status
        exec("zapret status").then(({ stdout }) => {
            if (stdout.includes("is running")) {
                main_status.innerText = t('zapret_working');
                main_icon.innerText = 'check_circle';
                main_icon.style.color = '#4caf50'; // Green
            } else {
                main_status.innerText = t('not_working');
                main_icon.innerText = 'error_outline';
                main_icon.style.color = '#f44336'; // Red
            }
        });

        // Check Autostart
        exec('[ -f "/data/adb/zapret/autostart" ] && echo "true" || echo "false"').then(({ stdout }) => {
            const isEnabled = stdout.trim() === 'true';
            autostart_checkbox.checked = isEnabled;
            autostart_note.innerText = isEnabled ? t('is_on') : t('is_off');
        });

        function manage_autostart(state) {
            if (state) {
                exec("zapret autostart-on").then(({ stdout }) => {
                    toast(stdout);
                    autostart_note.innerText = t('is_on');
                });
            } else {
                exec("zapret autostart-off").then(({ stdout }) => {
                    toast(stdout);
                    autostart_note.innerText = t('is_off');
                });
            }
        }
        window.manage_autostart = manage_autostart;
    </script>
</head>

<body>
    <nav class="m l left">
        <a class="active" href="index.html"><i>info</i><span class="translate" id="info">Инфо</span></a>
        <a href="domains.html"><i>domain</i><span class="translate" id="domains">Домены</span></a>
        <a href="config.html"><i>build</i><span class="translate" id="config">Конфиг</span></a>
        <a href="check.html"><i>check</i><span class="translate" id="check">Проверка</span></a>
    </nav>
    <nav class="s bottom">
        <a class="active" href="index.html"><i>info</i><span class="translate" id="info">Инфо</span></a>
        <a href="domains.html"><i>domain</i><span class="translate" id="domains">Домены</span></a>
        <a href="config.html"><i>build</i><span class="translate" id="config">Конфиг</span></a>
        <a href="check.html"><i>check</i><span class="translate" id="check">Проверка</span></a>
    </nav>
    <main class="responsive">
        
        <!-- Big centered status -->
        <div class="status-container">
            <i id="main_icon" class="status-icon">hourglass_empty</i>
            <h5 id="main_status">...</h5>
        </div>

        <div class="large-space"></div>

        <!-- Settings List Style -->
        <div class="row middle-align">
            <i class="primary-text">restart_alt</i>
            <div class="max">
                <h6 class="translate" id="autostart">Автозапуск</h6>
                <p id="autostart_note" class="small-text">...</p>
            </div>
            <label class="switch">
                <input type="checkbox" id="autostart_checkbox" onchange="manage_autostart(this.checked)">
                <span></span>
            </label>
        </div>

        <div class="divider"></div>

        <div class="row middle-align">
            <i class="error-text">bolt</i>
            <div class="max">
                <h6>Управление</h6>
                <p class="small-text">Используйте кнопку Action в меню модулей</p>
            </div>
        </div>

    </main>
    <script>
        if (!navigator.language.startsWith('ru')) {
            Array.from(document.getElementsByClassName('translate')).forEach(e => {
                e.innerText = t(e.id);
            });
        }
    </script>
</body>

</html>